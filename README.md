# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Карточка

```
interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number|null;
}
```

Базовый список карточек, получаемый с сервера

```
interface ICardsList {
  total: number;
  items: ICard[];
}
```

Модель данных карточек

```
interface ICardsData {
  cards: ICard[];
  preview: string|null;
}
```

Карточка без описания для основного списка

```
type TCardPreview = Omit<ICard, 'description'>;
```

Товар в корзине

```
type TCardBasketItem = Pick<ICard, 'id'|'title'|'price'>;
```

Данные для форм отправки заказа

```
interface IOrderData {
  payment: string;
  email: string;
  phone: string;
  address: string;
}
```

Ответ с результатом заказа

```
interface IOrderResult {
  id: string;
  total: number|null;
}
```

Ответ с ошибкой

```
interface IRequestError {
  error: string;
}
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP:
- слой данных, отвечает за хранение и изменение данных
- слой представления, отвечает за отображение данных на странице
- презентер, отвечает за связь представления и данных

### Базовый Код

#### Класс Api
Содержит в себе базовую логику отправки запросов. Конструктор принимает адрес сервера и опциональный объект с заголовками запросов .
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер (массив товаров либо конкретный товар если передать id).
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределён третьим параметром при вызове метода.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события в системе. Класс используется в презентере для обработки событий и в других слоях для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Классы данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с карточками, пришедшими с сервера. Конструктор класса принимает экземпляр брокера событий .\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек
- _preview: string|null - id карточки, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий

Так же класс предоставляет методы:
- getCard(cardId: string): ICard для получения карточки по id
- а так же геттеры и сеттеры для получения данных из полей класса

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными карточек товаров, выбранных пользователем. Конструктор класса принимает экземпляр брокера событий .\
В полях класса хранятся следующие данные:
- cart: ICard[] - массив выбранных товаров
- total: number - общая сумма заказа

Так же класс предоставляет методы:
- deleteItem(id: string): void - для удаления товара из корзины и вызова события изменения корзины
- getCartLength(cart: ICard[]): number - для получения количества товаров в корзине

### Классы представления

#### Класс CardView
Класс отвечает за отображение карточки товара на странице сайта.
Реализует интерфейс ICard. Принимает в конструктор DOM-элемент шаблона для создания карточки нужного типа (для списка на главной, для модалки и для корзины).
В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия пользователя с которыми генерируются события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор так же принимает экземпляр `EventEmitter` для инициации событий.
Методы:
- setData(cardData: ICard): void - заполняет атрибуты элементов карточки
- render(): HTMLElement - возвращает заполненную карточку с установленными слушателями

#### Класс Page
Реализует управление отображением каталога товаров и счётчика товаров в корзине. 
- constructor(cardsListContainer: HTMLElement, events: IEvents) - Конструктор принимает элемент-контейнер для списка товаров и экземпляр класса `EventEmitter`.
Поля класса:
- cardsListContainer: HTMLElement - контейнер для списка товаров
- basketButton: HTMLElement - кнопка корзины
- basketItemsCounter - счётчик товаров на иконке корзины
Методы:
set cardsList(items:TCardPreview[]): void - собирает список html элементов из объектов карточек
set basketItemsCounter - обновляет значение счётчика товаров в корзине


#### Класс Modal
Реализует модальное окно.  Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик по оверлею и кнопке закрытия для закрытия окна.
- constructor(selector: string, events: IEvents) - Конструктор принимает селектор , по которому в разметке будет найдено модальное окно(в нашем случаем общий контейнер для всех модальных окон) и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- modal: HTMLElement - хранит элемент модального окна
- events: EventEmitter - брокер событий

#### Класс ModalCardView
Расширяет класс Modal. Реализует модальное окно с карточкой товара. При открытии модального окна получает данные карточки, которую надо отобразить.
Методы:
- open(data: ICard): void - расширение родительского метода, принимает объект с полями карточки для заполнения элементов модального окна.
- close(): void - расширение родительского метода, выполняет очистку элементов окна перед закрытием.
- addItem(card: ICard): void - для добавления карточки в корзину кликом по кнопке и вызова события изменения корзины
- checkButtonState(): void - для проверки наличия товара в корзине и цены, чтобы обновлять состояние кнопки добавления

#### Класс ModalForm
Расширяет класс Modal, является родительским классом для классов модальных окон с конкретными формами. При сабмите инициирует событие , передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сабмита.\
Поля класса:
- submitButton:HTMLElement - Кнопка подтверждения
- _form: HTMLElement - элемент формы
- errorElement - элемент для отображения ошибок валидации
Методы:
- setError(inputField: HTMLElement, errorMessage): void - устанавливает сообщение об ошибке поля ввода
- hideInputError(inputField: HTMLElement): void - очищает сообщение об ошибке под указанным полем ввода
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- close(): void - расширяет родительский метод, очищая поля ввода и выключая кнопку сабмита

#### Класс DeliveryForm
Расширяет класс ModalForm, предоставляет форму для заполнения адреса доставки и выбора типа оплаты:
- paymentType: string[] - типы оплаты
- address: string - адрес доставки

#### Класс ContactsForm
Расширяет класс ModalForm, предоставляет форму для заполнения номера телефона и почты:
- phone: string - номер телефона
- email: string - почта

#### Класс Success
Расширяет класс Modal, хранит поля 
- orderSum: number - сумма заказа, которая приходит в ответе сервера
- successMessage: string - шаблонная строка с сообщением об успешном оформлении, куда будет подставлена сумма заказа.
- acceptButton: HTMLElement - кнопка подтверждения

#### CartItem